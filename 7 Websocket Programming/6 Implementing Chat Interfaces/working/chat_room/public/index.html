<!doctype html>
<head>
	<script src="http://localhost:3000/socket.io/socket.io.js"></script>
    <style type="text/css" media="screen">
		div#chatroom {
			display: block;
			height: 300px;
			border: 1px solid #999;
			overflow: auto;
			width: 100%;
			margin-bottom: 10px;
			position: relative;
		}
	
		ul#chat_log {
			list-style: none;
			position: absolute;
			bottom: 0px;
		}
	
		input#chat_box {
			width: 99%;
		}
	</style>
</head>
<body>

	<div id="chatroom">
    	<ul id="chat_log">
        </ul>
    </div>
    
    <input type="text" name="chat_box" value="" id="chat_box" placeholder="type text to chat . . .">


    <script type="text/javascript" charset="utf-8">
			/*
			var log_chat_message = function(message) {
				var li = jQuery('<li />').text(message);
				$('#chat_log').append(li);
			};
			*/
			var log_chat_message = function(message) {
				var li_node = document.createElement('li');
				var chat_node = document.querySelector('ul#chat_log');

				li_node.innerHTML = message;
				chat_node.appendChild(li_node);
			};
			
			var socket = io.connect('http://localhost:3000');
			
			socket.on('entrance', function(data) {
				log_chat_message(data.message);
			});

			socket.on('exit', function(data) {
				log_chat_message(data.message);
			});
			
			socket.on('chat', function(data) {
				log_chat_message(data.message);
			});
			/*
			jQuery('#chat_box').keypress(function(event) {
				if (event.which == 13) {
					socket.emit('chat', {message: jQuery('#chat_box').val()});
					jQuery('#chat_box').val('');
				}
			});
			*/
			var myChatBox = document.querySelector('input#chat_box');
			
			myChatBox.addEventListener('keydown', function(event) {
				console.log(event);
				if (event.which == 13) {
					socket.emit('chat', {message: myChatBox.value });
					myChatBox.value = '';
				}
			}, false);
        
	</script>

</body>
</html>